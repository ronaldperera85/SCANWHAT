RewriteEngine On
RewriteBase /scanwhat/  
# ^^^^^^^^^^^^^^^ (Cambiar a / cuando suba a la raíz del dominio web)

# --- REGLAS DE SEGURIDAD Y SSL ---
# Exclusión para el ACME challenge de Let's Encrypt/SSL
RewriteRule ^\.well-known/acme-challenge/ - [L]

# Impedir el acceso directo a la carpeta db/
RewriteRule ^db/ - [F] 
# (Asumo que el archivo db/conexion.php está en esa carpeta)

# --- REGLAS DE ENRUTAMIENTO ---

# 1. Redirigir el acceso a la raíz del sitio/subdirectorio a /menu
RewriteRule ^$ menu [R=301,L]

# 2. Excepción: /menu debe cargar index.php (El dashboard principal)
RewriteRule ^menu/?$ index.php [L]

# 3. Regla de limpieza (Redirecciona de /pages/file.php a /file)
# Esto asegura que las URLs en el navegador sean siempre limpias.
RewriteCond %{THE_REQUEST} \s/pages/([^\s.]+)\.php [NC]
RewriteRule ^pages/([^\s.]+)\.php$ %1 [R=301,L]

# 4. Regla genérica de enrutamiento (Interna: /file -> pages/file.php)
# Maneja login, registro, logout, etc.
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^([\w-]+)/?$ pages/$1.php [L]